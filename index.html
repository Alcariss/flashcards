<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcards</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#007BFF">
  <meta name="description" content="Interactive flashcards for learning fruits, vegetables, animals and more">
  <link rel="manifest" href="manifest.json">
  
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Flashcards">
  
  <!-- iOS Icons - Multiple Sizes -->
  <link rel="apple-touch-icon" sizes="57x57" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="60x60" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="72x72" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="76x76" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="114x114" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="144x144" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
  
  <!-- iOS Splash Screens -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-startup-image" href="icon-512.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="icon-512.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="icon-512.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="icon-512.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
  
  <!-- Fallback for older browsers -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  
  <style>
/* General styles for the page */
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  box-sizing: border-box;
  text-align: center;
  /* iOS-specific: Prevent bounce scrolling */
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  /* iOS-specific: Prevent text selection */
  -webkit-user-select: none;
  user-select: none;
}

/* iOS-specific: Fix viewport issues */
@supports (-webkit-touch-callout: none) {
  body {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }
}

h1 {
  margin: 20px 0;
  font-size: 28px;
}

.controls {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  margin: 20px;
}

button {
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  background-color: #007BFF;
  color: white;
  transition: background-color 0.3s;
}

button:hover {
  background-color: #0056b3;
}

/* Dropdown select styling */
select {
  padding: 12px 20px;
  font-size: 16px;
  border: 2px solid #007BFF;
  border-radius: 8px;
  background-color: white;
  color: #333;
  cursor: pointer;
  outline: none;
  min-width: 200px;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007BFF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 20px;
  padding-right: 45px;
}

select:hover {
  border-color: #0056b3;
  background-color: #f8f9fa;
}

select:focus {
  border-color: #0056b3;
  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

#refreshButton {
  background-color: #2196F3;
}

#refreshButton:hover {
  background-color: #0b7dda;
}

/* Grid layout for flashcards */
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 15px;
  padding: 20px;
  margin: 0 auto;
  max-width: 600px;
  aspect-ratio: 1; /* Makes the grid container square */
}

/* Flashcard container */
.flashcard {
  width: 100%;
  aspect-ratio: 1; /* Makes each card square */
  perspective: 1000px;
}

.inner {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transition: transform 0.5s;
  cursor: pointer;
}

.flashcard.flip .inner {
  transform: rotateY(180deg);
}

/* Front and back of the flashcard */
.front, .back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  border-radius: 8px;
}

.front {
  background-color: #f2f2f2;
  font-size: 4rem; /* Large emoji size - 64px */
}

.back {
  background-color: #4CAF50;
  color: white;
  transform: rotateY(180deg);
  font-size: 24px; /* Keep text size as original */
}

/* Responsive styles */
@media (max-width: 768px) {
  .controls {
    flex-direction: column;
    align-items: center;
  }

  select {
    width: 100%;
    max-width: 300px;
    font-size: 16px; /* Prevents zoom on iOS */
  }

  .grid {
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    padding: 10px;
    max-width: 400px;
  }

  .flashcard {
    aspect-ratio: 1; /* Keep cards square */
  }

  .front {
    font-size: 3rem; /* 48px for tablets */
  }

  .back {
    font-size: 20px; /* Keep text size as original */
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 24px;
  }

  select {
    font-size: 16px; /* Prevents zoom on iOS */
    padding: 10px 16px;
    max-width: 280px;
  }

  .grid {
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 10px;
    max-width: 300px;
  }

  .flashcard {
    aspect-ratio: 1; /* Keep cards square */
  }

  .front {
    font-size: 2.5rem; /* 40px for mobile */
  }

  .back {
    font-size: 16px; /* Keep text size as original */
  }
}
  </style>
</head>
<body>

  <div class="controls">
    <select id="categorySelect">
      <option value="fruits">üçé Fruits</option>
      <option value="vegetables">ü•ï Vegetables</option>
      <option value="vehicles">üöó Vehicles</option>
      <option value="animals">üê∂ Animals</option>
      <option value="sports">‚öΩ Sports</option>
      <option value="clothing">üëï Clothing</option>
      <option value="halloween">üéÉ Halloween</option>
    </select>
  </div>

  <div class="grid"></div>

  <script>
    // Categories data
    const categories = {
      fruits: [
        { name: "Apple", emoji: "üçé" },
        { name: "Banana", emoji: "üçå" },
        { name: "Cherry", emoji: "üçí" },
        { name: "Grape", emoji: "üçá" },
        { name: "Lemon", emoji: "üçã" },
        { name: "Mango", emoji: "ü•≠" },
        { name: "Orange", emoji: "üçä" },
        { name: "Peach", emoji: "üçë" },
        { name: "Pear", emoji: "üçê" },
        { name: "Pineapple", emoji: "üçç" },
        { name: "Strawberry", emoji: "üçì" },
        { name: "Watermelon", emoji: "üçâ" },
        { name: "Kiwi", emoji: "ü•ù" },
        { name: "Blueberry", emoji: "ü´ê" },
        { name: "Coconut", emoji: "ü••" },
        { name: "Avocado", emoji: "ü•ë" },
        { name: "Tangerine", emoji: "üçä" }
      ],
      vegetables: [
        { name: "Carrot", emoji: "ü•ï" },
        { name: "Broccoli", emoji: "ü•¶" },
        { name: "Potato", emoji: "ü•î" },
        { name: "Tomato", emoji: "üçÖ" },
        { name: "Cucumber", emoji: "ü•í" },
        { name: "Onion", emoji: "üßÖ" },
        { name: "Garlic", emoji: "üßÑ" },
        { name: "Eggplant", emoji: "üçÜ" },
        { name: "Pepper", emoji: "üå∂Ô∏è" },
        { name: "Lettuce", emoji: "ü•¨" },
        { name: "Corn", emoji: "üåΩ" },
        { name: "Mushroom", emoji: "üçÑ" },
        { name: "Zucchini", emoji: "ü•í" },
        { name: "Spinach", emoji: "üçÉ" },
        { name: "Asparagus", emoji: "üåø" }
      ],
      vehicles: [
        { name: "Car", emoji: "üöó" },
        { name: "Bus", emoji: "üöå" },
        { name: "Bicycle", emoji: "üö≤" },
        { name: "Motorcycle", emoji: "üèçÔ∏è" },
        { name: "Truck", emoji: "üöö" },
        { name: "Airplane", emoji: "‚úàÔ∏è" },
        { name: "Boat", emoji: "‚õ¥Ô∏è" },
        { name: "Helicopter", emoji: "üöÅ" },
        { name: "Train", emoji: "üöÜ" },
        { name: "Tram", emoji: "üöã" },
        { name: "Scooter", emoji: "üõ¥" },
        { name: "Rocket", emoji: "üöÄ" },
        { name: "Taxi", emoji: "üöñ" },
        { name: "Ship", emoji: "üö¢" },
        { name: "Submarine", emoji: "üõ≥Ô∏è" }
      ],
      animals: [
        { name: "Dog", emoji: "üê∂" },
        { name: "Cat", emoji: "üê±" },
        { name: "Mouse", emoji: "üê≠" },
        { name: "Hamster", emoji: "üêπ" },
        { name: "Rabbit", emoji: "üê∞" },
        { name: "Fox", emoji: "ü¶ä" },
        { name: "Bear", emoji: "üêª" },
        { name: "Panda", emoji: "üêº" },
        { name: "Koala", emoji: "üê®" },
        { name: "Tiger", emoji: "üêØ" },
        { name: "Lion", emoji: "ü¶Å" },
        { name: "Cow", emoji: "üêÆ" },
        { name: "Pig", emoji: "üê∑" },
        { name: "Frog", emoji: "üê∏" },
        { name: "Monkey", emoji: "üêµ" },
        { name: "Chicken", emoji: "üêî" },
        { name: "Penguin", emoji: "üêß" },
        { name: "Bird", emoji: "üê¶" },
        { name: "Baby Chick", emoji: "üê§" },
        { name: "Hatching Chick", emoji: "üê£" },
        { name: "Duck", emoji: "ü¶Ü" },
        { name: "Eagle", emoji: "ü¶Ö" },
        { name: "Owl", emoji: "ü¶â" },
        { name: "Bat", emoji: "ü¶á" },
        { name: "Wolf", emoji: "üê∫" },
        { name: "Horse", emoji: "üê¥" },
        { name: "Unicorn", emoji: "ü¶Ñ" },
        { name: "Bee", emoji: "üêù" },
        { name: "Caterpillar", emoji: "üêõ" },
        { name: "Butterfly", emoji: "ü¶ã" },
        { name: "Snail", emoji: "üêå" },
        { name: "Lady Beetle", emoji: "üêû" },
        { name: "Ant", emoji: "üêú" },
        { name: "Spider", emoji: "üï∑Ô∏è" },
        { name: "Scorpion", emoji: "ü¶Ç" },
        { name: "Crab", emoji: "ü¶Ä" },
        { name: "Lobster", emoji: "ü¶û" },
        { name: "Shrimp", emoji: "ü¶ê" },
        { name: "Squid", emoji: "ü¶ë" },
        { name: "Octopus", emoji: "üêô" },
        { name: "Fish", emoji: "üêü" },
        { name: "Tropical Fish", emoji: "üê†" },
        { name: "Blowfish", emoji: "üê°" },
        { name: "Shark", emoji: "ü¶à" },
        { name: "Whale", emoji: "üê≥" },
        { name: "Dolphin", emoji: "üê¨" },
        { name: "Crocodile", emoji: "üêä" },
        { name: "Turtle", emoji: "üê¢" },
        { name: "Lizard", emoji: "ü¶é" },
        { name: "Snake", emoji: "üêç" },
        { name: "Dragon", emoji: "üêâ" },
        { name: "Sauropod", emoji: "ü¶ï" },
        { name: "T-Rex", emoji: "ü¶ñ" }
      ],
      sports: [
        { name: "playing football", emoji: "‚öΩÔ∏è" },
        { name: "playing basketball", emoji: "üèÄ" },
        { name: "rollerblading", emoji: "üõº" },
        { name: "swimming", emoji: "üèä‚Äç‚ôÄÔ∏è" },
        { name: "skateboarding", emoji: "üõπ" },
        { name: "flying a kite", emoji: "ü™Å" },
        { name: "riding a bike", emoji: "üö≤" },
        { name: "bouncing", emoji: "‚õπ" },
        { name: "throwing a ball", emoji: "ü§Ω‚Äç‚ôÄÔ∏è" },
        { name: "playing baseball", emoji: "ü•é" }
      ],
      clothing: [
        { name: "T-Shirt", emoji: "üëï" },
        { name: "dress", emoji: "üëó" },
        { name: "trousers", emoji: "üëñ" },
        { name: "coat", emoji: "üß•" },
        { name: "socks", emoji: "üß¶" },
        { name: "boots", emoji: "üë¢" },
        { name: "shoes", emoji: "üëü" },
        { name: "swimming costume", emoji: "üëô" },
        { name: "gloves", emoji: "üß§" },
        { name: "hat", emoji: "üß¢" },
        { name: "shorts", emoji: "ü©≥" },
        { name: "bag", emoji: "üéí" },
        { name: "sunglasses", emoji: "üï∂Ô∏è" },
        { name: "umbrella", emoji: "‚òÇÔ∏è" }
      ],
      halloween: [
        { name: "Ghost", emoji: "üëª" },
        { name: "Pumpkin", emoji: "üéÉ" },
        { name: "Witch", emoji: "üßô‚Äç‚ôÄÔ∏è" },
        { name: "Vampire", emoji: "üßõ‚Äç‚ôÇÔ∏è" },
        { name: "Zombie", emoji: "üßü‚Äç‚ôÇÔ∏è" },
        { name: "Skeleton", emoji: "üíÄ" },
        { name: "Fairy", emoji: "üßö‚Äç‚ôÄÔ∏è" },
        { name: "Spider", emoji: "üï∑Ô∏è" },
        { name: "Bat", emoji: "ü¶á" },
        { name: "Black Cat", emoji: "üê±‚Äçüë§" },
        { name: "Witch Hat", emoji: "üßô‚Äç‚ôÄÔ∏è" },
        { name: "Crystal Ball", emoji: "üîÆ" },
        { name: "Cauldron", emoji: "üß™" },
        { name: "Candy", emoji: "üç¨" },
        { name: "Lollipop", emoji: "üç≠" },
        { name: "Chocolate", emoji: "üç´" },
        { name: "Jack-o'-lantern", emoji: "üéÉ" },
        { name: "Haunted House", emoji: "üèöÔ∏è" },
        { name: "Full Moon", emoji: "üåï" },
        { name: "Coffin", emoji: "‚ö∞Ô∏è" },
        { name: "Skull", emoji: "üíÄ" },
        { name: "Potion", emoji: "üß™" },
        { name: "Magic Wand", emoji: "ü™Ñ" },
        { name: "Tombstone", emoji: "ü™¶" },
        { name: "Candle", emoji: "üïØÔ∏è" }
      ]
    };

    // State
    let selectedCategory = 'fruits';
    const grid = document.querySelector('.grid');

    // Utility functions
    const shuffleArray = (arr) => {
      const shuffled = [...arr];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    };

    const pronounce = (text) => {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-UK';
      speechSynthesis.speak(utterance);
    };

    const createFlashcard = (item) => {
      const card = document.createElement('div');
      card.className = 'flashcard';
      card.innerHTML = `
        <div class="inner">
          <div class="front">${item.emoji}</div>
          <div class="back">${item.name}</div>
        </div>
      `;

      card.addEventListener('click', () => {
        const isFlipped = card.classList.contains('flip');
        
        if (!isFlipped) {
          // Card is showing emoji (front), pronounce and flip to text
          pronounce(item.name);
          card.classList.add('flip');
        } else {
          // Card is showing text (back), just flip back to emoji without pronouncing
          card.classList.remove('flip');
        }
      });

      return card;
    };

    const createFlashcards = () => {
      grid.innerHTML = '';
      const items = shuffleArray(categories[selectedCategory]).slice(0, 9);
      items.forEach(item => grid.appendChild(createFlashcard(item)));
    };

    // Event listeners
    const categorySelect = document.getElementById('categorySelect');
    categorySelect.addEventListener('change', (e) => {
      selectedCategory = e.target.value;
      createFlashcards();
    });

    // Initialize
    createFlashcards();

    // iOS Detection and PWA Features
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    
    // iOS-specific install prompt (since beforeinstallprompt doesn't work on iOS)
    if (isIOS && !isStandalone) {
      const iosInstallBtn = document.createElement('div');
      iosInstallBtn.innerHTML = `
        <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
                    background: #007BFF; color: white; padding: 15px 20px; border-radius: 10px; 
                    font-size: 14px; z-index: 1000; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
          üì± Install this app: Tap <strong>Share</strong> ‚Üí <strong>Add to Home Screen</strong>
          <button onclick="this.parentElement.parentElement.remove()" 
                  style="background: none; border: none; color: white; font-size: 18px; float: right; cursor: pointer;">√ó</button>
        </div>
      `;
      document.body.appendChild(iosInstallBtn);
      
      // Auto-hide after 10 seconds
      setTimeout(() => {
        if (iosInstallBtn.parentElement) {
          iosInstallBtn.remove();
        }
      }, 10000);
    }

    // iOS PWA updates now work automatically via service worker

    // PWA Install Prompt (for Android/Desktop)
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent Chrome 67 and earlier from automatically showing the prompt
      e.preventDefault();
      // Stash the event so it can be triggered later
      deferredPrompt = e;
      
      // Show install button
      const installBtn = document.createElement('button');
      installBtn.textContent = 'üì± Install App';
      installBtn.style.cssText = 'position: fixed; top: 10px; right: 10px; z-index: 1000; background: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 14px;';
      installBtn.addEventListener('click', () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
          }
          deferredPrompt = null;
          installBtn.remove();
        });
      });
      document.body.appendChild(installBtn);
    });

    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => {
            console.log('SW registered successfully:', registration.scope);
            
            // Handle service worker updates - Unified approach for all platforms
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              console.log('New service worker available');
              
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed') {
                  if (navigator.serviceWorker.controller) {
                    // Check if running as PWA/standalone app
                    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
                    
                    if (isStandalone) {
                      // Only show update notification for PWA/standalone apps
                      showUpdateNotification(newWorker);
                    } else {
                      // Web browser - just log, no notification needed
                      console.log('New version available (web browser will auto-update)');
                    }
                  } else {
                    // First time installation
                    console.log('App cached for offline use');
                  }
                }
              });
            });
            
            // Universal update check - same frequency for all platforms
            setTimeout(() => {
              registration.update();
            }, 2000);
          })
          .catch(registrationError => {
            console.error('SW registration failed:', registrationError);
          });
      });
    } else {
      console.log('Service workers are not supported');
    }

    // Show update notification (PWA/standalone apps only)
    function showUpdateNotification(newWorker) {
      // Check if notification already exists
      const existingBanner = document.getElementById('update-banner');
      if (existingBanner) {
        existingBanner.remove();
      }
      
      const updateBanner = document.createElement('div');
      updateBanner.id = 'update-banner';
      
      // Detect platform for appropriate messaging
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const platformIcon = isIOS ? 'üçé' : 'üì±';
      const platformText = isIOS ? 'iOS App' : 'PWA';
      
      updateBanner.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; right: 0; background: #007BFF; color: white; 
                    padding: 15px; text-align: center; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
          <div style="max-width: 600px; margin: 0 auto;">
            <strong>${platformIcon} New Update Available!</strong><br>
            <span style="font-size: 14px;">A new version with improvements is ready to install.</span><br>
            <div style="margin-top: 10px;">
              <button onclick="updateApp()" 
                      style="background: white; color: #007BFF; border: none; padding: 10px 20px; 
                             border-radius: 8px; margin: 0 5px; cursor: pointer; font-weight: bold; font-size: 14px;">
                ‚ú® Update Now
              </button>
              <button onclick="dismissUpdate()" 
                      style="background: transparent; color: white; border: 2px solid white; 
                             padding: 8px 16px; border-radius: 8px; margin: 0 5px; cursor: pointer; font-size: 14px;">
                Later
              </button>
            </div>
            <div style="font-size: 11px; margin-top: 8px; opacity: 0.9;">
              ${platformText} ‚Ä¢ Version ${document.querySelector('[id*="version"]')?.textContent || 'Unknown'}
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(updateBanner);
      
      // Store reference to new worker
      window.newServiceWorker = newWorker;
    }

    // Update app function (unified for all platforms)
    window.updateApp = function() {
      // Show immediate feedback
      const updateBtn = document.querySelector('button[onclick="updateApp()"]');
      if (updateBtn) {
        updateBtn.innerHTML = 'üîÑ Updating...';
        updateBtn.style.background = '#ccc';
        updateBtn.style.color = '#666';
        updateBtn.disabled = true;
      }
      
      // Update the banner message
      const banner = document.getElementById('update-banner');
      if (banner) {
        const messageDiv = banner.querySelector('div > div');
        if (messageDiv) {
          messageDiv.innerHTML = `
            <strong>üîÑ Installing Update...</strong><br>
            <span style="font-size: 14px;">Please wait, the app will reload automatically.</span>
          `;
        }
      }
      
      // Apply update
      if (window.newServiceWorker) {
        window.newServiceWorker.postMessage({ type: 'SKIP_WAITING' });
      }
      
      // Reload after a short delay to show feedback
      setTimeout(() => {
        window.location.reload();
      }, 1500);
    };

    // Dismiss update notification
    window.dismissUpdate = function() {
      const banner = document.getElementById('update-banner');
      if (banner) {
        banner.remove();
      }
    };

    // Dismiss update notification
    function checkForUpdates() {
      if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({ type: 'GET_VERSION' });
      }
    }

    // Add version display for troubleshooting
    function addVersionDisplay() {
      const versionDisplay = document.createElement('div');
      versionDisplay.style.cssText = `
        position: fixed; bottom: 10px; left: 10px; z-index: 1000;
        background: rgba(0,0,0,0.7); color: white; padding: 5px 10px;
        border-radius: 15px; font-size: 10px; opacity: 0.5;
      `;
      versionDisplay.textContent = 'v2.2.3';
      
      document.body.appendChild(versionDisplay);
    }

    // Add version display
    setTimeout(addVersionDisplay, 1000);

    // Unified periodic update check (every 30 minutes for all platforms)
    setInterval(checkForUpdates, 30 * 60 * 1000);
  </script>
</body>
</html>
